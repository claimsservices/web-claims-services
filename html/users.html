<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/"
  data-template="vertical-menu-template-free">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

  <title>ST - User Management</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/3P4.ico" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet" />

  <!-- Icons. Uncomment required icon fonts -->
  <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />

  <!-- Core CSS -->
  <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="../assets/css/demo.css" />

  <!-- Vendors CSS -->
  <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

  <link rel="stylesheet" href="../assets/vendor/libs/apex-charts/apex-charts.css" />

  <!-- Page CSS -->

  <!-- Helpers -->
  <script src="../assets/vendor/js/helpers.js"></script>

  <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
  <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
  <script src="../assets/js/config.js"></script>

  <style type="text/css">
    .layout-menu-fixed .layout-navbar-full .layout-menu,
    .layout-menu-fixed-offcanvas .layout-navbar-full .layout-menu {
      top: 64px !important;
    }
    .layout-page {
      padding-top: 64px !important;
    }
    .content-wrapper {
      padding-bottom: 54px !important;
    }</style>

<script>
  // Check if the user has a valid token and the required role
  const accessToken = localStorage.getItem('authToken'); // Check if token is available
  const RETURN_LOGIN_PAGE = '../index.html';
  console.log("aaa" + accessToken);

    // If there's no token, redirect to login
    if (!accessToken) {
      window.location.href = RETURN_LOGIN_PAGE;
    }

</script>

</head>

<body>
  <!-- Layout wrapper -->
  <div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
      <!-- Menu -->
      <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
        <div class="app-brand demo d-flex align-items-center justify-content-between px-3 py-3"
            style="background-color: #f9f8f4; border-bottom: 1px solid #e5e5e5;">
            <div class="d-flex align-items-center">
              <a href="#" class="app-brand-link d-flex align-items-center">
                <span class="app-brand-logo demo me-3">
                  <img src="..\assets\img\elements\3P4.jpg" alt="Logo" width="60" style="object-fit: contain;">
                </span>
              </a>
              <div style="line-height: 1.3;">
                <div style="font-size: 0.9rem; color: #a68b64; font-weight: 400; margin-bottom: 2px;">
                  Welcome to
                </div>
                <div style="font-size: 0.95rem; color: #b38e5d; font-weight: 600;">
                  ST Application
                </div>
              </div>
            </div>
          
            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large d-block d-xl-none ms-auto">
              <i class="bx bx-chevron-left bx-sm align-middle" style="color: #b38e5d;"></i>
            </a>
          </div>

        <div class="menu-inner-shadow"></div>

        <ul class="menu-inner py-1">
          <!-- Dashboard -->
          <li class="menu-item">
              <a href="dashboard.html" class="menu-link menu-toggle">
                <i class="menu-icon icon-base bx bx-car"></i>
                <div data-i18n="Analytics">Application Service</div>
              </a>
              <ul class="menu-sub">
                <li class="menu-item">
                  <a href="dashboard.html" class="menu-link">
                    <i class='menu-icon icon-base bx  bx-clipboard'></i>
                    <div data-i18n="Without menu">Task Management</div>
                  </a>
                </li>
              </ul>
            </li>

          <!-- Layouts -->
          <li class="menu-item active open">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <i class="menu-icon icon-base bx bx-user"></i>
              <div data-i18n="Layouts">User management</div>
            </a>

            <ul class="menu-sub">
              <li class="menu-item active">
                <a href="users.html" class="menu-link">
                  <div data-i18n="Without menu">Administrator</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="account.html" class="menu-link">
                  <div data-i18n="Without navbar">Account Settings</div>
                </a>
              </li>
            </ul>
          </li>
        </ul>
        <div class="menu-footer mt-auto p-3 border-top">
            <div class="d-flex flex-column align-items-start">
              <span id="appVersion" class="text-muted small mb-2"></span>
              <a href="javascript:void(0)" class="btn btn-sm btn-outline-danger w-100" id="logout-menu">
                <i class="bx bx-log-out-circle me-1"></i> Logout
              </a>
            </div>
      </aside>
      <!-- Core JS -->
     <script>
      fetch('/version.json')
        .then(res => res.json())
        .then(data => {
          document.getElementById("appVersion").textContent = `App Version ${data.version}`;
        })
        .catch(() => {
          document.getElementById("appVersion").textContent = "App Version -";
        });
    </script>
      <!-- / Menu -->

      <!-- Layout container -->
      <div class="layout-page">
        <!-- Navbar -->

        <nav
          class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
          id="layout-navbar">
          <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
            <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
              <i class="bx bx-menu bx-sm"></i>
            </a>
          </div>

          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">

            <ul class="navbar-nav flex-row align-items-center ms-auto">

              <!-- User -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                  <a class="nav-link dropdown-toggle hide-arrow d-flex align-items-center gap-3" href="javascript:void(0);"
                    data-bs-toggle="dropdown">
                    <div class="avatar avatar-online">
                      <img id="userAvatar" src="../assets/img/avatars/A1.png" alt class="w-px-40 h-auto rounded-circle" />
                    </div>
                    <div class="text-start">
                      <span class="fw-semibold d-block" id="user-info"></span>
                      <small class="text-muted" id="user-role"></small>
                    </div>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <a class="dropdown-item" href="account.html">
                      <i class="bx bx-user me-2"></i>
                      <span class="align-middle">My Profile</span>
                    </a>
                </li>
                <li>
                  <div class="dropdown-divider"></div>
                </li>
                <li>
                  <a class="dropdown-item" href="" id="logout">
                    <i class="bx bx-power-off me-2"></i>
                    <span class="align-middle">Log Out</span>
                  </a>
                </li>
              </ul>
              </li>
              <!--/ User -->
            </ul>
          </div>
        </nav>

        <!-- / Navbar -->

        <!-- Content wrapper -->
        <div class="content-wrapper">
          <!-- Content -->
        
          <div class="container-xxl flex-grow-1 container-p-y">
            <!-- Bootstrap Table with Header - Dark -->
            <div class="card">
              <div class="card-header border-bottom">
                <h5 class="card-title mb-3">Search Users</h5> <!-- Added margin-bottom class -->
                <div class="row align-items-center g-3">
                  <div class="col-md-4">
                    <label for="dt-search-0" class="form-label visually-hidden">Search User</label>
                    <div class="d-flex">
                      <input type="search" class="form-control" id="dt-search-0" placeholder="Search User" />
                      <button id="search-btn" class="btn btn-secondary ms-2">Search</button>
                      <!-- Added search button inside the same div -->
                    </div>
                  </div>
                  <div class="col-md-4 ms-auto d-flex justify-content-end">
                    <button id="new-user-btn" class="btn rounded-pill btn-primary" tabindex="0"
                      aria-controls="DataTables_Table_0" type="button" data-bs-toggle="offcanvas"
                      data-bs-target="#offcanvasAddUser"><span><i class="icon-base bx bx-plus icon-sm me-0 me-sm-2"></i><span
                          class="d-none d-sm-inline-block">Add New User</span></span></button>
                  </div>
                </div>
              </div>
        
              <!-- Offcanvas for Adding New User -->
              <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasAddUser" aria-labelledby="offcanvasAddUserLabel"
                aria-modal="true" role="dialog">
                <div class="offcanvas-header border-bottom py-4">
                  <h5 id="offcanvasAddUserLabel" class="offcanvas-title text-uppercase fw-bold">Add User</h5>
                  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body mx-0 p-4">
                  <form class="add-new-user pt-0 fv-plugins-bootstrap5 fv-plugins-framework" id="addNewUserForm"
                    onsubmit="return false" novalidate="novalidate">
                    <!-- Username Field -->
                    <div class="mb-4">
                      <label class="form-label" for="add-user-username">Username <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="add-user-username" placeholder="Enter username"
                        name="username" aria-label="Username" required>
                    </div>
        
                    <!-- Password Field -->
                    <div class="mb-4">
                      <label class="form-label" for="add-user-password">Password <span class="text-danger">*</span></label>
                      <input type="password" class="form-control" id="add-user-password" placeholder="Enter password"
                        name="userPassword" aria-label="Password" required>
                    </div>
        
                    <!-- Confirm Password Field -->
                    <div class="mb-4">
                      <label class="form-label" for="add-user-confirm-password">Confirm Password <span class="text-danger">*</span></label>
                      <input type="password" class="form-control" id="add-user-confirm-password"
                        placeholder="Confirm your password" name="userConfirmPassword" aria-label="Confirm Password" required>
                    </div>
        
                    <!-- First Name Field -->
                    <div class="mb-4">
                      <label class="form-label" for="add-user-name">First Name</label>
                      <input type="text" class="form-control" id="add-user-name" placeholder="Enter first name" name="name"
                        aria-label="First Name" required>
                    </div>
        
                    <!-- Last Name Field -->
                    <div class="mb-4">
                      <label class="form-label" for="add-user-surename">Last Name</label>
                      <input type="text" class="form-control" id="add-user-surename" placeholder="Enter last name"
                        name="surename" aria-label="Last Name" required>
                    </div>
        
                    <!-- Email Field -->
                    <div class="mb-4">
                      <label class="form-label" for="add-user-email">Email <span class="text-danger">*</span></label>
                      <input type="email" id="add-user-email" class="form-control" placeholder="email@example.com"
                        aria-label="email@example.com" name="userEmail" required>
                    </div>
        
                    <!-- Contact Field -->
                    <div class="mb-4">
                      <label class="form-label" for="add-user-contact">Contact <span class="text-danger">*</span></label>
                      <input type="text" id="add-user-contact" class="form-control phone-mask" placeholder="+1 (609) 988-44-11"
                        aria-label="Contact Number" name="userContact" required>
                    </div>
        
                    <!-- User Role Field -->
                    <div class="mb-4">
                      <label class="form-label" for="user-role-regist">User Role</label>
                      <select id="user-role-regist" class="form-select" required>
                        <option value="">Select Roles</option>
                        <option value="Officer">Officer</option>
                        <option value="Admin Officer">Admin Officer</option>
                        <option value="Leader">Leader</option>
                        <option value="Sales Manager">Sales Manager</option>
                        <option value="Operation Manager">Operation Manager</option>
                        <option value="Director">Director</option>
                      </select>
                    </div>
        
                    <!-- Submit & Cancel Buttons -->
                    <div class="d-flex justify-content-between mt-3">
                      <button type="submit" class="btn btn-primary">Submit</button>
                      <button type="reset" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas">Cancel</button>
                    </div>
                  </form>
                </div>
              </div>
        
              <script>
                // Example of password validation
                document.getElementById("addNewUserForm").onsubmit = function (e) {
                  e.preventDefault();

                  var password = document.getElementById("add-user-password").value;
                  var confirmPassword = document.getElementById("add-user-confirm-password").value;
                  var email = document.getElementById("add-user-email").value;
                  var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/; // Email regex pattern

                  if (email === null) {
                    alert("Please enter  email address.");
                    return;
                  }

                  if (!emailRegex.test(email)) {
                    alert("Please enter a valid email address.");
                    return;
                  }

                  if (password !== confirmPassword) {
                    alert("Passwords do not match!");
                  } else {
                    // Continue with form submission or other actions
                    alert("User added successfully!");
                  }
                };
              </script>
        
        
        
              <div class="table-responsive text-nowrap">
                <table class="table">
                  <thead class="table-dark">
                    <tr>
                      <th>Username</th>
                      <th>Mobile</th>
                      <th>Role</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="userTableBody" class="table-border-bottom-0">
                    <!-- Sample Row -->
                    <tr></tr>
                  </tbody>
                </table>
              </div>
            </div>
            <!-- /Bootstrap Table with Header Dark -->
        
        
          </div>
          <!-- / Content -->
        
          <!-- Footer -->
          <footer class="content-footer footer bg-footer-theme">
          </footer>
          <!-- / Footer -->
        
          <div class="content-backdrop fade"></div>
        </div>
        <!-- Content wrapper -->

      </div>
      <!-- / Layout page -->
    </div>

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
  </div>
  <!-- / Layout wrapper -->

  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="../assets/vendor/libs/jquery/jquery.js"></script>
  <script src="../assets/vendor/libs/popper/popper.js"></script>
  <script src="../assets/vendor/js/bootstrap.js"></script>
  <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

  <script src="../assets/vendor/js/menu.js"></script>
  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="../assets/vendor/libs/apex-charts/apexcharts.js"></script>

  <!-- Main JS -->
  <script src="../assets/js/main.js"></script>

  <!-- Page JS -->
  <script src="../assets/js/dashboards-analytics.js"></script>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <script>
    // Constants for URLs and other fixed strings
    const LOGIN_PAGE = '../index.html';
    const API_URL = 'https://be-claims-service.onrender.com/api/auth/profile';

    // Function to decode JWT token and check for expiration
    function decodeJWT(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        return JSON.parse(atob(base64));  // Decode the token
      } catch (e) {
        console.error('Failed to decode JWT:', e);
        return null;
      }
    }

    // Function to check if the token is expired
    function isTokenExpired(decodedToken) {
      const currentTime = Math.floor(Date.now() / 1000); // Get current time in seconds
      return decodedToken && decodedToken.exp && decodedToken.exp < currentTime;
    }

    // Main logic
    async function loadUserProfile() {
      const token = localStorage.getItem('authToken'); // Check if token is available

      // If there's no token, redirect to login
      if (!token) {
        window.location.href = LOGIN_PAGE;
        return;
      }

      // Decode the JWT token (assuming it's a JWT token)
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const decoded = JSON.parse(atob(base64));

      // Extract user info (name and role)
      const id = decoded.id;
      const userName = decoded.username;
      const email = decoded.email;
      const role = decoded.role;
      const myPicture = decoded.myPicture;

      // Display user information in the HTML
      document.getElementById('user-info').innerText = userName;
      document.getElementById('user-role').innerText = role;

      const imageUrl = myPicture;  // Extract the image URL from the response
      const imgElement = document.getElementById('userAvatar');
      const imgElement2 = document.getElementById('subUserAvatar');
      imgElement.src = imageUrl;  // Update the image src dynamically
      imgElement2.src = imageUrl;  // Update the image src dynamically

      if (decoded && isTokenExpired(decoded)) {
        // Token is expired
        localStorage.removeItem('authToken'); // Clear token
        window.location.href = LOGIN_PAGE; // Redirect to login page
        return;
      }

      // If the token is valid, fetch user profile
      try {
        const response = await fetch(API_URL, {
          method: 'GET',
          headers: {
            'Authorization': `${token}`,  // Use the token in the Authorization header
          },
        });
        console.log(response);
        if (!response.ok) {
          //If the response is not OK(e.g., 401 Unauthorized), clear token and redirect
          localStorage.removeItem('authToken');
          window.location.href = LOGIN_PAGE;
          return;
        }
      } catch (error) {
        //Handle fetch errors(network issues, etc.)
        console.error('Error fetching user profile:', error);
        localStorage.removeItem('authToken');
        window.location.href = LOGIN_PAGE; // Redirect to login page on error
      }
    }


    // Call the function to load the user profile
    loadUserProfile();
  </script>

  <script>
    const API_URL_USERS = 'https://be-claims-service.onrender.com/api/user-management/users'; // Update with your backend URL

    async function fetchUsers() {
      const token = localStorage.getItem('authToken');
      if (!token) {
        window.location.href = '../index.html'; // Redirect if no token
        return;
      }

      try {
        const response = await fetch(API_URL_USERS, {
          method: 'GET',
          headers: {
            Authorization: token,
          },
        });

        if (!response.ok) {
          console.error('Failed to fetch users:', response.status);
          //window.location.href = '../index.html'; // Redirect on error
          return;
        }

        const data = await response.json();
        populateTable(data.results);
      } catch (error) {
        console.error('Error fetching users:', error);
        ///window.location.href = '../index.html'; // Redirect on network error
      }
    }

    function populateTable(users) {
      const tableBody = document.getElementById('userTableBody');
      tableBody.innerHTML = ''; // Clear existing table rows

      users.forEach((user) => {
        const row = document.createElement('tr');

        row.innerHTML = `
  <td>
  <div class="d-flex align-items-center">
    <img 
      src="${user.profile_picture ? user.profile_picture : '../assets/img/avatars/A1.png'}" 
      alt="Avatar" 
      class="rounded-circle" 
      width="30" 
    />
    <div class="ms-3">
      <strong>${user.username}</strong><br />
      <small>${user.email}</small>
    </div>
  </div>
</td>

  <td>${user.phone}</td>
 <td class="user-role">
  ${user.role === 'Operations Manager' ? 
    `<i class="icon-base bx bx-desktop text-danger me-2"></i>${user.role}` : 
    `<i class="icon-base bx bx-user text-success me-2"></i>${user.role}`}
</td>

  <td>
    ${user.is_active ? '<span class="badge bg-label-success" text-capitalized="">Active</span>' : '<span class="badge bg-label-secondary" text-capitalized="">Inactive</span>'}
  </td>
  <td>
    <div class="d-flex align-items-center">
      <a href="javascript:;" class="btn btn-icon delete-record" data-username="${user.username}">
        <i class="icon-base bx bx-trash icon-md"></i>
      </a>
      <a href="app-user-view-account.html" class="btn btn-icon">
        <i class="icon-base bx bx-show icon-md"></i>
      </a>
      <a href="javascript:;" class="btn btn-icon dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
        <i class="icon-base bx bx-dots-vertical-rounded icon-md"></i>
      </a>
      <div class="dropdown-menu dropdown-menu-end m-0">
        <a href="javascript:;" class="dropdown-item">Active</a>
        <a href="javascript:;" class="dropdown-item">Inactive</a>
      </div>
    </div>
  </td>
`;

        tableBody.appendChild(row);
      });
    }

    // Load users on page load
    fetchUsers();
  </script>

<script>
  document.getElementById("addNewUserForm").onsubmit = function(e) {
    e.preventDefault();
    
    var username = document.getElementById("add-user-username").value;
    var password = document.getElementById("add-user-password").value;
    var confirmPassword = document.getElementById("add-user-confirm-password").value;
    var firstName = document.getElementById("add-user-name").value;
    var lastName = document.getElementById("add-user-surename").value;
    var email = document.getElementById("add-user-email").value;
    var contact = document.getElementById("add-user-contact").value;
    var role = document.getElementById("user-role-regist").value;
    
                  var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/; // Email regex pattern

                  
                  if (!email || email.trim() === "") {
    alert("Please enter a email address.");
    return;
}

                  if (!contact || contact.trim() === "") {
    alert("Please enter a contact number.");
    return;
}

                  if (!emailRegex.test(email)) {
                    alert("Please enter a valid email address.");
                    return;
                  }

                  if (password !== confirmPassword) {
                    alert("Passwords do not match!");
                  } else {
                    // Continue with form submission or other actions
                    alert("User added successfully!");
                  }
    
    // Prepare the data for the API call
    var data = {
      username: username,
      password: password,
      email: email,
      first_name: firstName,
      last_name: lastName,
      phone: contact,
      role: role
    };
    
    // Send a POST request to the API using fetch
    fetch('https://be-claims-service.onrender.com/api/auth/register', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(data => {
      // Handle the response from the API
      console.log('Success:', data);
      alert('User added successfully!');
      // Optionally, reset the form or close the offcanvas
      document.getElementById("addNewUserForm").reset();
      // Optionally, close the offcanvas (if you're using Bootstrap's offcanvas)
      var offcanvas = new bootstrap.Offcanvas(document.getElementById('offcanvasAddUser'));
      offcanvas.hide();
      // Refresh the page
      location.reload();
    })
    .catch((error) => {
      // Handle any errors
      console.error('Error:', error);
      alert('Failed to add user!');
    });
  };
</script>

<script>
  // Event delegation for dynamically added delete buttons
  document.addEventListener('click', async (event) => {
    // Check if the clicked element is a delete button
    const deleteButton = event.target.closest('.delete-record');
    if (!deleteButton) return;

    // Retrieve the username from the data attribute
    const username = deleteButton.getAttribute('data-username');
    if (!username) {
      alert('Error: No username found for this record.');
      return;
    }

    // Retrieve the authentication token
    const token = localStorage.getItem('authToken');
    if (!token) {
      alert('Session expired. Redirecting to login.');
      window.location.href = '../index.html'; // Redirect if no token
      return;
    }

    // Confirm the action with the user
    const confirmDelete = confirm(`Are you sure you want to delete the user: ${username}?`);
    if (!confirmDelete) return;

    try {
      // Disable the button to prevent multiple requests
      deleteButton.disabled = true;

      // Send the DELETE request to the server
      const response = await fetch('https://be-claims-service.onrender.com/api/user-management/delete-user', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json',
          authorization: token,
        },
        body: JSON.stringify({ username }),
      });

      // Handle the server response
      if (!response.ok) {
        const errorData = await response.json();
        alert(`Error: ${errorData.message}`);
      } else {
        alert('User deleted successfully.');
        // Remove the user's row from the UI
        const userRow = deleteButton.closest('tr'); // Adjust selector to match your DOM
        if (userRow) userRow.remove();
      }
    } catch (error) {
      console.error('Error deleting user:', error);
      alert('An unexpected error occurred. Please try again later.');
    } finally {
      // Re-enable the button after the request completes
      deleteButton.disabled = false;
    }
  });
</script>

<script>
  // Check user role (example assumes role is stored in localStorage)
  const token = localStorage.getItem('authToken');
  if (token) {
    const user = JSON.parse(atob(token.split('.')[1])); // Decode JWT payload

    // Check if the user has the 'admin' role
    if (user.role === 'Operations Manager' || user.role === 'Director' || user.role === 'Developer') {
      // Show the admin menu
      document.getElementById('admin-menu').style.display = 'block';
    }
    if (user.role === 'Officer') {
      localStorage.removeItem('authToken');
      window.location.href = '../index.html';
    }
  }
</script>


  <script>
    // Logout function to clear token and redirect
    document.getElementById('logout').addEventListener('click', function (event) {
      event.preventDefault(); // Prevent the default anchor link behavior

      // Clear the token from localStorage
      localStorage.removeItem('authToken');

      // Optionally, redirect the user to the login page or home page
      window.location.href = '../index.html'; // Modify this if you want to redirect somewhere else
    });
  </script>

</body>

</html>